# 计算机网络  
![TCP/IP](https://github.com/Passion-long/Passion-long.github.io/blob/master/Figure/TCP_IP.png)    
应用层：HTTP、SMTP、FTP；  
传输层：TCP、UDP；  
网络层：ICMP（网际控制报文协议，ping用来测试两个主机之间的连通性，没有通过TCP和UDP）、IGMP（网际组管理协议）、IP、ARP（地址解析协议）；中间设备：路由器。  
数据链路层：中间设备：网桥、交换机。
物理层：    中间设备：网卡、中继器、集线器、转发器。  
  
## 传输层：TCP和UDP  

**1. 什么是三次握手？**  
  
![三次握手](https://github.com/Passion-long/Passion-long.github.io/blob/master/Figure/Three_handshakes.png)  
第一次握手：Client将SYN置1，随机产生一个初始序列号seq发送给Server，进入SYN_SENT状态；  
第二次握手：Server收到Client的SYN=1之后，知道客户端请求建立连接，将自己的SYN置1，ACK置1，产生一个acknowledge number=sequence number+1，并随机产生一个自己的初始序列号，发送给客户端；进入SYN_RCVD状态；  
第三次握手：客户端检查acknowledge number是否为序列号+1，ACK是否为1，检查正确之后将自己的ACK置为1，产生一个acknowledge number=服务器发的序列号+1，发送给服务器；进入ESTABLISHED状态；服务器检查ACK为1和acknowledge number为序列号+1之后，也进入ESTABLISHED状态；完成三次握手，连接建立。  
  
**2. TCP建立连接可以两次握手吗？为什么？**  
答：第三次握手是为了防止失效的连接请求到达服务器，让服务器错误打开连接。  
如果有第三次握手，客户端会忽略服务器之后发送的对滞留连接请求的连接确认，不进行第三次握手，因此就不会再次打开连接。  
  
**3. 可以采用四次握手吗？为什么？**  
答：可以。但是会降低传输的效率。  

**4. 什么是四次挥手？**  
  
![四次握手](https://github.com/Passion-long/Passion-long.github.io/blob/master/Figure/Four_waves.png)  
第一次挥手：Client将FIN置为1，发送一个序列号seq给Server；进入FIN_WAIT_1状态；  
第二次挥手：Server收到FIN之后，发送一个ACK=1，acknowledge number=收到的序列号+1；进入CLOSE_WAIT状态。此时客户端已经没有要发送的数据了，但仍可以接受服务器发来的数据。  
第三次挥手：Server将FIN置1，发送一个序列号给Client；进入LAST_ACK状态；  
第四次挥手：Client收到服务器的FIN后，进入TIME_WAIT状态；接着将ACK置1，发送一个acknowledge number=序列号+1给服务器；服务器收到后，确认acknowledge number后，变为CLOSED状态，不再向客户端发送数据。客户端等待2*MSL（报文段最长寿命）时间后，也进入CLOSED状态。完成四次挥手。  
  
**5. 客户端TIME_WAIT的意义是什么？（为什么要等待2MSL）？**  
答：第四次挥手时，客户端发送给服务器的ACK有可能丢失，TIME_WAIT状态就是用来重发可能丢失的ACK报文。如果Server没有收到ACK，就会重发FIN，如果Client在2*MSL的时间内收到了FIN，就会重新发送ACK并再次等待2MSL，防止Server没有收到ACK而不断重发FIN。  
  
**6. TCP和UDP的区别是什么？**  
* TCP是面向连接的，UDP是无连接的。  
* TCP可靠，UDP不可靠。  
* TCP只支持点对点通信，UDP支持一对一，一对多，多对一，多对多。  
* TCP是面向字节流的，UDP是面向报文的。  
* TCP有拥堵控制机制，UDP没有。  
* TCP首部开销（20字节）比UDP首部开销（8字节）要大。  
* UDP主机不需要维持复杂的连接状态表。  
  
**7. 选择题：TCP不确保数据能按续到达。**  
  
**8. TCP如何保证传输的可靠性？**  
* 数据包校验  
* 对失序数据包重新排序（TCP报文具有序列号）  
* 丢弃重复数据  
* 应答机制  
* 超时重发  
* 流量控制  
  
**9. TCP的流量控制：**  
使用滑动窗口协议实现流量控制。防止发送方发送速率太快，接收方缓存区不够导致溢出。接收方会维护一个接收窗口 receiver window（窗口大小单位是字节），接收窗口的大小是根据自己的资源情况动态调整的，在返回ACK时将接收窗口大小放在TCP报文中的窗口字段告知发送方。发送窗口的大小不能超过接收窗口的大小，只有当发送方发送并收到确认之后，才能将发送窗口右移。  
  
发送窗口的上限为接受窗口和拥塞窗口中的较小值。接受窗口表明了接收方的接收能力，拥塞窗口表明了网络的传送能力。  
  
<details>  
<summary>什么是零窗口（接收窗口为0时会怎样）？</summary>  
   
如果接收方没有能力接收数据，就会将接收窗口设置为0，这时发送方必须暂停发送数据，但是会启动一个持续计时器(persistence timer)，到期后发送一个大小为1字节的探测数据包，以查看接收窗口状态。如果接收方能够接收数据，就会在返回的报文中更新接收窗口大小，恢复数据传送。    
   
</details>    
  
**10. TCP的拥堵控制：**  
  
![慢开始和拥塞避免](https://github.com/Passion-long/Passion-long.github.io/blob/master/Figure/Slow_start_and_congestion_avoidance.png)  
拥塞控制主要由四个算法组成：慢启动（Slow Start）、拥塞避免（Congestion voidance）、快重传 （Fast Retransmit）、快恢复（Fast Recovery）  
  
(1). 慢启动：刚开始发送数据时，先把拥塞窗口（congestion window）设置为1个最大报文段MSS的数值，每收到一个新的确认报文之后，就把拥塞窗口加1个MSS。这样每经过一个传输轮次（或者说是每经过一个往返时间RTT），拥塞窗口的大小就会加倍。  
![cwnd](https://github.com/Passion-long/Passion-long.github.io/blob/master/Figure/cwnd.png)  
(2). 拥塞避免：当拥塞窗口的大小达到慢开始门限(slow start threshold)时，开始执行拥塞避免算法，拥塞窗口大小不再指数增加，而是线性增加，即每经过一个传输轮次只增加1MSS。  
  
无论在慢开始阶段还是在拥塞避免阶段，只要发送方判断网络出现拥塞（其根据就是没有收到确认），就要把慢开始门限ssthresh设置为出现拥塞时的发送方窗口值的一半（但不能小于2）。然后把拥塞窗口cwnd重新设置为1，执行慢开始算法。（这是不使用快重传的情况）  

(3). 快重传：快重传要求接收方在收到一个失序的报文段后就立即发出重复确认（为的是使发送方及早知道有报文段没有到达对方）而不要等到自己发送数据时捎带确认。快重传算法规定，发送方只要一连收到三个重复确认就应当立即重传对方尚未收到的报文段，而不必继续等待设置的重传计时器时间到期。  
![快重传](https://github.com/Passion-long/Passion-long.github.io/blob/master/Figure/Fast_retransmission.png)  
  
(4). 快恢复：当发送方连续收到三个重复确认时，就把慢开始门限减半，然后执行拥塞避免算法。不执行慢开始算法的原因：因为如果网络出现拥塞的话就不会收到好几个重复的确认，所以发送方认为现在网络可能没有出现拥塞。
也有的快重传是把开始时的拥塞窗口cwnd值再增大一点，即等于 ssthresh + 3\*MSS 。这样做的理由是：既然发送方收到三个重复的确认，就表明有三个分组已经离开了网络。这三个分组不再消耗网络的资源而是停留在接收方的缓存中。可见现在网络中减少了三个分组。因此可以适当把拥塞窗口扩大些。
    
**11. https的连接过程？**  
* 客户端发送请求到服务端。  
* 服务端返回公钥和证书到客户端。  
* 客户端接收后会验证证书的安全性，如果通过则会随机生成一个随机数，用证书中的公钥对其加密，发送到服务端。  
* 服务端接收到这个加密后的随机数后会用私钥对其解密得到真正的随机数，随后用这个随机数当做私钥（对称密钥）对需要发送的数据进行对称加密。  
* 客户端在接收到加密后的数据使用私钥（即生成的随机数）对数据进行解密并且解析数据呈现结果给客户。  
* SSL加密建立。  
  
**12. 套接字的定义：**
每一条TCP连接都有两个端点。TCP连接的端点叫做套接字（socket）或插口。端口号拼接到IP地址即构成了套接字。因此，套接字的表示方法是在点分十进制的IP地址后面写上端口号，中间用冒号或逗号隔开。例如，若IP地址是192.3.4.5而端口号是80，那么得到的套接字就是(192.3.4.5:80)。总之，我们有  
套接字socket = (IP地址：端口号)  
每一条TCP连接唯一地被通信两端的两个端点（即两个套接字）所确定。即：  
TCP连接::={socket1, socket2}={(IP1:port1),(IP2:port2)}  
  
**13. ICMP 的功能包括：**  
差错报告、测试目的站是否可达、消息询问。
（ICMP是TCP/IP协议族中的一种协议，位于IP层，属于网络层协议，主要用于在主机与路由器之间传递控制信息，包括报告错误、交换受限控制和状态信息等。）
  
**14. 在HDLC（高级数据链路控制，是一个在同步网上传输数据、面向比特的数据链路层协议）中，数据比特串0111101111110装帧发送出去的串为（01111011111010）。**  
解释：HDLC协议每次发送方要发送的信息中含有5个以上连续的1时，它总要在第五个1后面插入一个冗余的0，不管第6个位是0还是1，这个额外的0都要插入。  
  
**15. 主机甲和主机乙之间建立一个TCP连接，TCP最大段长度为1000字节，若主机甲的当前拥塞窗口为4000字节，在主机甲向主机乙连续发送两个最大段后，成功收到主机乙发送的第一个段的确认段，确认段中通告的接收窗口大小为2000字节，则此时主机甲还可以向主机乙发送的最大字节数是(1000)**  
解释：依题意，主机甲的当前拥塞窗口为4000B，主机甲向主机乙连续发送2个最大段，其中第1个段的序列号为4000，窗口值为1000；第2个段的序列号为5000，窗口值为1000。主机甲成功接收到主机乙发送的第一段的确认段，确认段的序列号为5000，其通告的接收窗口大小为2000B，则说明此时主机乙具有一个2000B的空闲缓冲区，即此时主机乙最大还可以接收2000B的数据。由于主机乙还未对主机甲发出第2个报文段进行确认，因此这2000B的空闲缓冲区还需预留出1000B用于接收第2个报文段，即此时主机甲还可以向主机乙发送的最大字节数只有1000B。  
  
**16. voip都用了哪些协议?（SIP、MEGACO、H.323、MGCP）**  
解释：VOIP ，即指在 IP 网络上使用 IP 协议以数据包的方式传输语音。使用 VOIP 协议，不管是因特网、企业内部互连网还是局域网都可以实现语音通信。一个使用 VOIP 的网络中，语音信号经过数字化，压缩并转换成 IP 包，然后在 IP 网络中进行传输 。 VOIP 信令协议用于建立和取消呼叫，传输用于定位用户以及协商能力所需的信息。电话网络的主要特点是低成本；数据、语音和视频在同一网络上的合成；集中式网络上的新服务以及对终端用户的简单化管理。目前，存在一些VOIP 协议栈，它们源于各种标准团体和提供商，如 H.323、SIP、MEGACO 和 MGCP 。  
  
**17. 欺骗攻击详解：**  
* https://wenku.baidu.com/view/07fe2817900ef12d2af90242a8956bec0875a537.html  
  
**18. DoS攻击攻击之详解：**  
* https://blog.51cto.com/wushank/1156004  
    
## 应用层：HTTP和HTTPS  
**1. HTTP和HTTPS的区别是什么？**  
* 端口不同：http使用80端口，https使用443端口。  
* http信息是明文传输，https运行在SSL之上，添加了加密和认证机制，更加安全。  
* https由于加密解密会带来更大的CPU和内存消耗。  
* https通信需要证书，一般需要向证书颁发机构购买。  
  
**2. 输入 www.baidu.com， 怎么变成 https://www.baidu.com 的，怎么确定用HTTP还是HTTPS？**  
* 一种是原始的302跳转，服务器把所有的HTTp流量跳转到HTTPS。但这样有一个漏洞，就是中间人可能在第一次访问站点的时候就劫持。 解决方法是引入HSTS机制，用户浏览器在访问站点的时候强制使用HTTPS。  
  
**3. 什么是对称加密、非对称加密？区别是什么？**  
* 对称加密：加密和解密采用相同的密钥。  
* 非对称加密：如果用公钥加密，需要用私钥才能解密。  
* 区别：对称加密速度更快，通常用于大量数据的加密；非对称加密安全性更高   
  
**4. 在客户端和服务器之间进行请求——响应时，两种最常被用到的方法是：GET和POST。**  
* GET——从指定的资源请求数据  
* POST——向指定的资源提交要被处理的数据  
  
**5. GET和POST的区别是什么？**  
* GET是幂等的，即读取同一个资源，总是得到相同的数据，POST不是幂等的；  
* GET一般用于从服务器获取资源，而POST有可能改变服务器上的资源；
* 一般从服务器获取数据，并且客户端也不用提交上面的数据的时候，可以使用GET；一般提交数据到服务器使用的是POST；  
* 请求形式上：GET请求的数据附在URL之后，在HTTP请求头中；POST请求的数据在请求体中；  
* 安全性：GET请求可被缓存、收藏、保留到历史记录，且其请求数据明文出现在URL中。POST的参数不会被保存，安全性相对较高；  
* GET只允许ASCII字符，POST对数据类型没有要求，也允许二进制数据；  
* GET的长度有限制（操作系统或者浏览器），而POST数据大小无限制  
  
**6. Session和Cookie的区别是什么？**  
* Session是服务器端保持状态的方案，Cookie是客户端保持状态的方案  
* Cookie保存在客户端本地，客户端请求服务器时会将Cookie一起提交；Session保存在服务端，通过检索Sessionid查看状态。保存Sessionid的方式可以采用Cookie，如果禁用了Cookie，可以使用URL重写机制（把会话ID保存在URL中）。  
  
**7. 从输入网址到获得页面的过程？（或输入URL之后的过程？）**   
* 浏览器查询DNS，获取域名对应的IP地址。  
* 浏览器向服务器请求建立连接，发起三次握手。  
* TCP/IP连接建立起来后，浏览器向服务器发送HTTP请求。  
* 服务器接收到这个请求，并根据路径参数映射到特定的请求处理器进行处理，并将处理结果及相应的视图返回给浏览器。  
* 浏览器解析并渲染视图，若遇到对js文件，css文件及图片等静态资源的引用，则重复上述步骤并向服务器请求这些资源。  
* 浏览器根据其请求到的资源、数据渲染页面，最终向用户呈现一个完整的页面。  
  
**8.Web资源分两类：**  
静态资源：html、js/css  
动态资源：servlet、jsp  
  
**9. servlet是什么？**  
（先学习几天前端。）


## 网络层协议  
**1. 什么是RIP（路由信息协议）(Routing Information Protocol)？**  
* 每个路由器维护一张表，记录该路由器到其他网络的“跳数”，路由器到与其直接连接的网络的跳数是1，每多经过一个路由器跳数就加1。交付数据报时优先选取距离最近的路径。  
  
**2.  什么是ARP协议 (Address Resolution Protocol)？**  
* ARP完成了IP地址和物理地址的映射。  
  
**3.  什么是NAT (Network Address Translation, 网络地址转换)？**  
* 用于解决内网中的主机和因特网中的主机通信。  

**4. HTTP请求有哪些常见的状态码？**  
* 1XX状态码：通知信息，如请求收到了或正在进行处理。
* 2XX状态码：操作成功，如接受或知道了。  
* 3XX状态码：重定向，如要完成请求还必须采取进一步的行动。（重定向：）  
* 4XX状态码：客户端错误，如请求中有错误的语法或不能完成。  
  * 400 Bad Request 错误的请求
  * 403 Forbidden 服务器拒绝请求  
  * 404 NotFound 未找到资源  
  * 405 Method Not Allowed 不允许使用的方法  
* 5XX状态码：服务端错误，如服务器失效无法完成请求。  
  
**5. 网络的OSI模型是什么？**  
* 应用层、表示层、会话层、传输层、网络层、数据链路层、物理层  
  
**6. DNS是什么层？原理是什么？**  
* 应用层。原理：浏览器输入地址，然后浏览器这个进程区调操作系统某个库里的gethostbyname函数，然后这个函数通过网卡给DNS服务器发UDP请求，接收结果，然后将结果返回给浏览器。  
  
**7. 在公司局域网上ping www.bilibili.com 没有涉及到的网络协议是？TCP**  
* 用到了DNS域名解析，ICMP请求回显数据包，ARP通过IP获取MAC地址。  
  
**8. 网关是什么？**  
* 网关实质上是一个网络通向其他网络的IP地址。比如有网络A和网络B，网络A的IP地址范围为“192.168.1.1 ~ 192.168.1.254”，子网掩码为255.255.255.0；网络B的IP地址范围为“192.168.2.1 ~ 192.168.2.254”，子网掩码为255.255.255.0。在没有路由器的情况下，两个网络之间是不能进行TCP/IP通信的，即使是两个网络连接在同一台交换机（或 集线器）上，TCP/IP协议也会根据子网掩码（255.255.255.0）判定两个网络中的主机处在不同的网络里。而要实现这两个网络之间的通信，则必须通过网关。如果网络A中的主机发现数据包的目的主机不在本地网络中，就把数据包转发给它自己的网关，再由网关转发给网络B的网关，网络B的网关再转发给网络B的某个主机。  
  
  
  
  
